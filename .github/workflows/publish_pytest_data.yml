name: Publish pytest data to S3
permissions:
  contents: read
on: 
  workflow_call:
    inputs:
      environment: { type: string, required: true }
  workflow_dispatch:
    inputs:
      environment: { type: environment, required: true }
      run_id: { type: number, required: true }
run-name: Publish ${{github.ref}} to arcticdb-pytest-data
env:
  OUTPUT_PATH: ${{github.runner.temp}}/gh_artifacts
jobs:
  sync_pytest_xmls:
    runs-on: ubuntu-22.04
    steps:
      - name: Gather pytest xmls from run ${{ github.run_id }}
        id: gather-pytest-xmls
        uses: actions/download-artifact@v4
        with:
            pattern: "pytest-*"
            run-id: ${{ github.run_id }}
            github-token: ${{github.token}}  
            output-path: ${{env.OUTPUT_PATH}}


      - name: Install requirements
        run: |
          python3 -m pip install arcticdb click

      - name: Process pytest xmls
        run: |
          python3 build_tooling/process_pytest_artifacts.py --download-dir ${{env.OUTPUT_PATH}} --run-id ${{ github.run_id }}
