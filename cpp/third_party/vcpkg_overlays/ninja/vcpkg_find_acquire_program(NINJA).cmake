# Override ninja version to use 1.10.2 which is compatible with older GLIBCXX
set(program_name ninja)
set(program_version 1.10.2)
set(tool_subdirectory)
set(interpreter)
set(search_names ninja)
set(download_urls)
set(download_filename)
set(supported_on_unix ON)
set(version_command --version)
set(paths_to_search)
set(post_install_command)

if(CMAKE_HOST_WIN32)
    set(download_filename "ninja-win-${program_version}.zip")
    set(download_urls "https://github.com/ninja-build/ninja/releases/download/v${program_version}/ninja-win.zip")
    set(tool_subdirectory "${program_version}-windows")
    set(paths_to_search "${DOWNLOADS}/tools/ninja-${program_version}-windows")
    set(download_sha512 6004140d92e86afbb17b49c49037ccd0786ce238f340f7d0e62b4b0c29ed0d6ad0bab11feda2094ae849c387d70d63504393714ed0a426fc1af0d0efb4d8c30f)
elseif(CMAKE_HOST_SYSTEM_NAME STREQUAL "Darwin")
    set(download_filename "ninja-mac-${program_version}.zip")
    set(download_urls "https://github.com/ninja-build/ninja/releases/download/v${program_version}/ninja-mac.zip")
    set(tool_subdirectory "${program_version}-osx")
    set(paths_to_search "${DOWNLOADS}/tools/ninja-${program_version}-osx")
    set(download_sha512 482ecb23c59ae3d4f158029112de172f0c513bc7667ee5f74e59eac3f05a0c9fd94bd0c3a0d81aaf6ca286a16e6f5998c428193e3c49fd2a1922a7b22e2fafe9)
elseif(CMAKE_HOST_SYSTEM_NAME STREQUAL "Linux")
    vcpkg_execute_in_download_mode(COMMAND "uname" "-m" OUTPUT_VARIABLE HOST_ARCH OUTPUT_STRIP_TRAILING_WHITESPACE)
    if(HOST_ARCH MATCHES "x86_64|amd64|AMD64")
        set(download_filename "ninja-linux-${program_version}.zip")
        set(download_urls "https://github.com/ninja-build/ninja/releases/download/v${program_version}/ninja-linux.zip")
        set(tool_subdirectory "${program_version}-linux")
        set(paths_to_search "${DOWNLOADS}/tools/ninja-${program_version}-linux")
        set(download_sha512 763464859c7ef2ea3a0a10f4df40d2025d3bb9438fcb1228404640410c0ec48d04148489ad5ac4c82fdeb6a8a8fd875f3a68e03b1a0f3137ee57e5398cb6f3e5)
    elseif(HOST_ARCH MATCHES "arm64|aarch64|ARM64|AARCH64")
        # No official aarch64 build for 1.10.2, fall back to system ninja
        if(DEFINED ENV{VCPKG_FORCE_SYSTEM_BINARIES})
            set(program_name)
            set(paths_to_search)
            return()
        endif()
        message(STATUS "Ninja 1.10.2 not available for ARM64, will try to find system ninja")
        set(program_name)
        set(paths_to_search)
        return()
    else()
        if(DEFINED ENV{VCPKG_FORCE_SYSTEM_BINARIES})
            set(program_name)
            set(paths_to_search)
            return()
        endif()
        message(FATAL_ERROR "Unsupported host architecture for prebuilt ninja: ${HOST_ARCH}")
    endif()
else()
    message(FATAL_ERROR "Unsupported host platform: ${CMAKE_HOST_SYSTEM_NAME}")
endif()

